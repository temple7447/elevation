<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Demo: Find highest elevation in range</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js"></script>
  <link href="https://api.tiles.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      padding: 0;
    }

    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
    }

    .ele-info {
      position: absolute;
      font-family: sans-serif;
      margin-top: 5px;
      margin-left: 5px;
      padding: 5px;
      width: 200px;
      border: 2px solid black;
      font-size: 20px;
      color: #222;
      background-color: #fff;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="ele-info">
    <div>Longitude:&nbsp;<span id="lng"></span></div>
    <div>Latitude:&nbsp;<span id="lat"></span></div>
    <div>Elevation:&nbsp;<span id="ele"></span></div>
    <div>Highest Elevation Place:&nbsp;<span id="highest-elevation-place"></span></div>
  </div>
  <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoidGVtcGxlNzQ0NyIsImEiOiJjbG00NDRpYWIyYWc1M2NwNmZseXp0ajl4In0.mCfPnhtfrVDQKwtBO_p34A';
    let  map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/streets-v12',
      center: [6.318584, 7.140653],
      zoom: 11.5
    });

    let lng;
    let lat;
    const lngDisplay = document.getElementById('lng');
    const latDisplay = document.getElementById('lat');
    const eleDisplay = document.getElementById('ele');
    const highestElevationPlaceDisplay = document.getElementById('highest-elevation-place');
    const scannedLocations = []; // Array to store scanned locations

    const marker = new mapboxgl.Marker({
      'color': '#314ccd'
    });

    map.on('click', (event) => {
      marker.setLngLat(event.lngLat).addTo(map);
      lng = event.lngLat.lng;
      lat = event.lngLat.lat;
      getElevation();
    });

    async function getElevation() {
      const query = await fetch(
        `https://api.mapbox.com/v4/mapbox.mapbox-terrain-v2/tilequery/${lng},${lat}.json?layers=contour&limit=50&access_token=${mapboxgl.accessToken}`,
        { method: 'GET' }
      );
      if (query.status !== 200) return;
      const data = await query.json();
      lngDisplay.textContent = lng.toFixed(2);
      latDisplay.textContent = lat.toFixed(2);
      const allFeatures = data.features;

      let highestElevationFeature = null;
      let highestElevation = Number.NEGATIVE_INFINITY;

      allFeatures.forEach((feature) => {
        const elevation = feature.properties.ele;
        if (elevation > highestElevation) {
          highestElevation = elevation;
          highestElevationFeature = feature;
        }
      });

      eleDisplay.textContent = `${highestElevation} meters`;

      if (highestElevationFeature) {
        const placeName = highestElevationFeature.properties.name;
        highestElevationPlaceDisplay.textContent = placeName;
        console.log(`Highest elevation place: ${placeName}`);
      } else {
        highestElevationPlaceDisplay.textContent = 'N/A';
      }

      // Store the scanned location data in the array
      scannedLocations.push({ lng, lat, elevation: highestElevation });
    }

    // Function to find the highest elevation within the specified range
    async function findHighestElevationInRange() {
      let highestElevation = Number.NEGATIVE_INFINITY;
      let highestElevationLat = null;
      let highestElevationLng = null;

      for (let i = 0; i < 20; i++) { // You can adjust the number of iterations
        const [lng, lat] = getRandomLatLong();
        marker.setLngLat([lng, lat]).addTo(map);
        lngDisplay.textContent = lng.toFixed(2);
        latDisplay.textContent = lat.toFixed(2);

        await getElevation();

        if (parseFloat(eleDisplay.textContent) > highestElevation) {
          highestElevation = parseFloat(eleDisplay.textContent);
          highestElevationLat = lat;
          highestElevationLng = lng;
        }
      }

      if (highestElevationLat !== null && highestElevationLng !== null) {
        console.log(`Highest elevation found at Latitude: ${highestElevationLat}, Longitude: ${highestElevationLng}, Elevation: ${highestElevation} meters`);
      } else {
        console.log('No data found in the specified range.');
      }

      // Process the scanned locations array to find the overall highest elevation
      let overallHighestElevation = Number.NEGATIVE_INFINITY;
      let overallHighestLocation = null;

      scannedLocations.forEach((location) => {
        if (location.elevation > overallHighestElevation) {
          overallHighestElevation = location.elevation;
          overallHighestLocation = location;
        }
      });

      if (overallHighestLocation) {
        console.log(`Overall highest elevation found at Latitude: ${overallHighestLocation.lat}, Longitude: ${overallHighestLocation.lng}, Elevation: ${overallHighestLocation.elevation} meters`);
      } else {
        console.log('No data found in the scanned locations.');
      }
    }

    // Call the function to find the highest elevation within the range
    findHighestElevationInRange();

    // Function to generate random latitude and longitude within the specified range
    function getRandomLatLong() {
      const startLat = 7.050;
      const endLat = 7.1200;
      const startLng = 6.260;
      const endLng = 6.310;
      const randomLat = startLat + Math.random() * (endLat - startLat);
      const randomLng = startLng + Math.random() * (endLng - startLng);
   
   
      return [randomLng, randomLat];
    }
  </script>
</body>
</html>
